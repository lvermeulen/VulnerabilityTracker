using System.Threading.Tasks;
using OssIndex.Api.Models;
using Xunit;

namespace OssIndex.Api.Tests
{
    public class OssIndexClientShould
    {
        private readonly OssIndexClient _client;

        public OssIndexClientShould()
        {
            _client = new OssIndexClient("https://ossindex.sonatype.org");
        }

        [Theory]
        [InlineData(PackageManagerTypes.NuGet, "Flurl.Http.Xml", "1.5.0")]
        [InlineData(PackageManagerTypes.NuGet, "Flurl.Http.Xml", null)]
        [InlineData(PackageManagerTypes.NuGet, "jquery", "2.0.0")]
        [InlineData(PackageManagerTypes.Npm, "yup", "0.24.1")]
        public async Task GetPackageVersionAsync(PackageManagerTypes packageManager, string packageName, string packageVersion)
        {
            var result = await _client.GetPackageVersionAsync(packageManager, packageName, packageVersion);
            Assert.NotNull(result);
        }

        [Theory]
        [InlineData(PackageManagerTypes.NuGet, "Flurl.Http.Xml", "1.5.0")]
        [InlineData(PackageManagerTypes.Npm, "yup", "0.24.1")]
        public async Task GetPackagesAsync(PackageManagerTypes packageManager, string packageName, string packageVersion)
        {
            var request = new PackageRequest
            {
                Pm = packageManager.ToString().ToLowerInvariant(),
                Name = packageName,
                Version = packageVersion
            };

            var result = await _client.GetPackagesAsync(request);
            Assert.NotNull(result);
        }
    }
}
